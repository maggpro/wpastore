<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Настройки - WPA.STORE</title>
    <link rel="stylesheet" href="styles/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .settings-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .settings-section h3 {
            color: #333;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-row.full {
            grid-template-columns: 1fr;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group .help-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        .github-status {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .github-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .github-status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .github-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-connection {
            margin-top: 1rem;
        }
        
        .settings-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }
        
        .btn-reset {
            background: #6c757d;
            color: white;
        }
        
        .btn-reset:hover {
            background: #5a6268;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 2rem;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .token-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 1rem;
        }
        
        .token-info h4 {
            margin-top: 0;
            color: #333;
        }
        
        .token-info ol {
            margin: 0;
            padding-left: 1.5rem;
        }
        
        .token-info li {
            margin-bottom: 0.5rem;
        }
        
        .token-info code {
            background: #e9ecef;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <a href="index.html" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Вернуться к приложению
        </a>
        
        <h1><i class="fas fa-cog"></i> Настройки WPA.STORE</h1>
        
        <!-- GitHub настройки -->
        <div class="settings-section">
            <h3><i class="fab fa-github"></i> GitHub интеграция</h3>
            
            <div id="githubStatus" class="github-status warning">
                <i class="fas fa-exclamation-triangle"></i>
                <span>GitHub настройки не настроены</span>
            </div>
            
            <form id="githubForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="githubOwner">GitHub Username *</label>
                        <input type="text" id="githubOwner" placeholder="your-username" required>
                        <div class="help-text">Ваш GitHub username (без @)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="githubRepo">Название репозитория *</label>
                        <input type="text" id="githubRepo" placeholder="WPA.STORE" required>
                        <div class="help-text">Название репозитория для хранения данных</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="githubToken">Personal Access Token</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                    <div class="help-text">Токен для записи данных (опционально, для публичного доступа не нужен)</div>
                </div>
                
                <div class="form-group">
                    <label for="useIssuesAsDB">Использовать Issues как БД</label>
                    <select id="useIssuesAsDB">
                        <option value="true">Да</option>
                        <option value="false">Нет (только LocalStorage)</option>
                    </select>
                    <div class="help-text">Хранить данные в GitHub Issues вместо LocalStorage</div>
                </div>
                
                <div class="test-connection">
                    <button type="button" id="testConnection" class="btn btn-primary">
                        <i class="fas fa-plug"></i> Проверить соединение
                    </button>
                </div>
            </form>
            
            <div class="token-info">
                <h4>Как получить GitHub Personal Access Token?</h4>
                <ol>
                    <li>Перейдите в <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings → Developer settings → Personal access tokens</a></li>
                    <li>Нажмите "Generate new token (classic)"</li>
                    <li>Выберите "repo" права для полного доступа к репозиторию</li>
                    <li>Скопируйте токен и вставьте в поле выше</li>
                    <li><strong>Важно:</strong> Сохраните токен в надежном месте, он больше не будет показан</li>
                </ol>
            </div>
        </div>
        
        <!-- Настройки приложения -->
        <div class="settings-section">
            <h3><i class="fas fa-mobile-alt"></i> Настройки приложения</h3>
            
            <form id="appForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="itemsPerPage">Элементов на странице</label>
                        <select id="itemsPerPage">
                            <option value="6">6</option>
                            <option value="12">12</option>
                            <option value="24">24</option>
                            <option value="48">48</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="searchDebounce">Задержка поиска (мс)</label>
                        <select id="searchDebounce">
                            <option value="100">100</option>
                            <option value="300">300</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="enableNotifications">Уведомления</label>
                        <select id="enableNotifications">
                            <option value="true">Включены</option>
                            <option value="false">Отключены</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="enableAnimations">Анимации</label>
                        <select id="enableAnimations">
                            <option value="true">Включены</option>
                            <option value="false">Отключены</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Настройки UI -->
        <div class="settings-section">
            <h3><i class="fas fa-palette"></i> Настройки интерфейса</h3>
            
            <form id="uiForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="theme">Тема</label>
                        <select id="theme">
                            <option value="light">Светлая</option>
                            <option value="dark">Темная</option>
                            <option value="auto">Авто</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="language">Язык</label>
                        <select id="language">
                            <option value="ru">Русский</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="showRatings">Показывать рейтинги</label>
                        <select id="showRatings">
                            <option value="true">Да</option>
                            <option value="false">Нет</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="showDownloads">Показывать загрузки</label>
                        <select id="showDownloads">
                            <option value="true">Да</option>
                            <option value="false">Нет</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Действия -->
        <div class="settings-actions">
            <button type="button" id="saveSettings" class="btn btn-primary">
                <i class="fas fa-save"></i> Сохранить настройки
            </button>
            <button type="button" id="resetSettings" class="btn btn-reset">
                <i class="fas fa-undo"></i> Сбросить настройки
            </button>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/github-db.js"></script>
    <script>
        // Инициализация страницы настроек
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            updateGitHubStatus();
            
            // Обработчики событий
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            document.getElementById('resetSettings').addEventListener('click', resetSettings);
            document.getElementById('testConnection').addEventListener('click', testGitHubConnection);
            
            // Автосохранение при изменении
            document.querySelectorAll('select, input').forEach(element => {
                element.addEventListener('change', () => {
                    // Автосохранение с небольшой задержкой
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(saveSettings, 1000);
                });
            });
        });
        
        // Загрузка настроек в форму
        function loadSettings() {
            // GitHub настройки
            document.getElementById('githubOwner').value = ConfigManager.get('github.owner', '');
            document.getElementById('githubRepo').value = ConfigManager.get('github.repo', '');
            document.getElementById('githubToken').value = ConfigManager.get('github.token', '');
            document.getElementById('useIssuesAsDB').value = ConfigManager.get('github.useIssuesAsDB', true).toString();
            
            // Настройки приложения
            document.getElementById('itemsPerPage').value = ConfigManager.get('app.itemsPerPage', 12);
            document.getElementById('searchDebounce').value = ConfigManager.get('app.searchDebounce', 300);
            document.getElementById('enableNotifications').value = ConfigManager.get('app.enableNotifications', true).toString();
            document.getElementById('enableAnimations').value = ConfigManager.get('app.enableAnimations', true).toString();
            
            // Настройки UI
            document.getElementById('theme').value = ConfigManager.get('ui.theme', 'light');
            document.getElementById('language').value = ConfigManager.get('ui.language', 'ru');
            document.getElementById('showRatings').value = ConfigManager.get('ui.showRatings', true).toString();
            document.getElementById('showDownloads').value = ConfigManager.get('ui.showDownloads', true).toString();
        }
        
        // Сохранение настроек
        function saveSettings() {
            // GitHub настройки
            ConfigManager.set('github.owner', document.getElementById('githubOwner').value);
            ConfigManager.set('github.repo', document.getElementById('githubRepo').value);
            ConfigManager.set('github.token', document.getElementById('githubToken').value);
            ConfigManager.set('github.useIssuesAsDB', document.getElementById('useIssuesAsDB').value === 'true');
            
            // Настройки приложения
            ConfigManager.set('app.itemsPerPage', parseInt(document.getElementById('itemsPerPage').value));
            ConfigManager.set('app.searchDebounce', parseInt(document.getElementById('searchDebounce').value));
            ConfigManager.set('app.enableNotifications', document.getElementById('enableNotifications').value === 'true');
            ConfigManager.set('app.enableAnimations', document.getElementById('enableAnimations').value === 'true');
            
            // Настройки UI
            ConfigManager.set('ui.theme', document.getElementById('theme').value);
            ConfigManager.set('ui.language', document.getElementById('language').value);
            ConfigManager.set('ui.showRatings', document.getElementById('showRatings').value === 'true');
            ConfigManager.set('ui.showDownloads', document.getElementById('showDownloads').value === 'true');
            
            updateGitHubStatus();
            
            // Показываем уведомление
            if (window.Utils && window.Utils.showNotification) {
                Utils.showNotification('Настройки сохранены!', 'success');
            } else {
                alert('Настройки сохранены!');
            }
        }
        
        // Сброс настроек
        function resetSettings() {
            if (confirm('Сбросить все настройки к значениям по умолчанию?')) {
                ConfigManager.reset();
            }
        }
        
        // Обновление статуса GitHub
        function updateGitHubStatus() {
            const statusElement = document.getElementById('githubStatus');
            const validation = ConfigManager.validateGitHubConfig();
            
            if (validation.valid) {
                statusElement.className = 'github-status success';
                statusElement.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>GitHub настроен: ${ConfigManager.get('github.owner')}/${ConfigManager.get('github.repo')}</span>
                `;
            } else {
                statusElement.className = 'github-status warning';
                statusElement.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>${validation.message}</span>
                `;
            }
        }
        
        // Тестирование соединения с GitHub
        async function testGitHubConnection() {
            const owner = document.getElementById('githubOwner').value;
            const repo = document.getElementById('githubRepo').value;
            
            if (!owner || !repo) {
                alert('Пожалуйста, заполните username и название репозитория');
                return;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
                
                if (response.ok) {
                    const repoData = await response.json();
                    alert(`✅ Соединение успешно!\n\nРепозиторий: ${repoData.full_name}\nОписание: ${repoData.description || 'Не указано'}\nЯзык: ${repoData.language || 'Не определен'}`);
                } else if (response.status === 404) {
                    alert('❌ Репозиторий не найден. Проверьте username и название репозитория.');
                } else {
                    alert(`❌ Ошибка: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                alert(`❌ Ошибка соединения: ${error.message}`);
            }
        }
    </script>
</body>
</html>
